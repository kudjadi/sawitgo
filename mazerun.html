<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Maze Paint Â· mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        body {
            background: #0e2a2f;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100dvh;
            font-family: 'Segoe UI', Roboto, sans-serif;
            padding: 8px;
            touch-action: pan-y;  /* prevent scroll while drawing */
        }
        .game-wrap {
            background: #1a3f46;
            padding: 16px 12px 20px;
            border-radius: 40px 40px 28px 28px;
            box-shadow: 0 12px 20px rgba(0,0,0,0.5);
            max-width: 550px;
            width: 100%;
            border: 1px solid #47909b;
        }
        canvas {
            display: block;
            margin: 0 auto;
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            border-radius: 24px;
            box-shadow: inset 0 0 0 2px #0e282e, 0 12px 20px #00000050;
            cursor: pointer;
            touch-action: none;  /* kill all browser drag/zoom */
        }
        .panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 18px;
            padding: 0 6px;
            gap: 12px;
            flex-wrap: wrap;
        }
        .percent-box {
            background: #102e34;
            padding: 12px 22px;
            border-radius: 60px;
            font-weight: 700;
            font-size: 1.3rem;
            color: #d6ffff;
            box-shadow: inset 0 4px 6px rgba(0,0,0,0.6), inset 0 -2px 4px #3e8e9a;
            border-bottom: 3px solid #50b8c4;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            justify-content: center;
            letter-spacing: 2px;
        }
        .btn-reset {
            background: #3c7a82;
            border: none;
            border-bottom: 6px solid #184e56;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            padding: 12px 24px;
            border-radius: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 8px 0 #0b2d32, 0 10px 20px black;
            transition: 0.05s ease;
            flex: 0.5;
            min-width: 140px;
            letter-spacing: 2px;
            touch-action: manipulation;
        }
        .btn-reset:active {
            transform: translateY(8px);
            box-shadow: 0 2px 0 #0b2d32, 0 10px 20px black;
            border-bottom-width: 2px;
        }
        .hint-mobile {
            color: #b2e6ed;
            font-size: 0.85rem;
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 4px 10px;
            background: #1f4a52b0;
            border-radius: 50px;
            backdrop-filter: blur(2px);
            margin-top: 6px;
        }
        .emoji-big {
            font-size: 1.4rem;
        }
        @media (max-width: 450px) {
            .panel { flex-direction: column; }
            .btn-reset { width: 100%; }
            .percent-box { width: 100%; }
        }
    </style>
</head>
<body>
<div class="game-wrap">
    <!-- canvas ukuran 500x500, grid 20x20 biar jari gampang -->
    <canvas id="mazeCanvas" width="500" height="500"></canvas>
    
    <div class="panel">
        <div class="percent-box">
            <span class="emoji-big">ðŸŽ¨</span>
            <span id="percentText">0%</span>
        </div>
        <button class="btn-reset" id="resetBtn">
            <span style="font-size:1.5rem;">ðŸ”„</span> maze
        </button>
    </div>
    <div class="hint-mobile">
        <span>ðŸ‘‰  geser jari â€¢ cat labirin</span>
        <span style="margin-left:auto;">ðŸš« tembok</span>
    </div>
</div>

<script>
    (function() {
        'use strict';

        // ---- setting lebih ramah jari: grid 20x20 (kotak 25px) ----
        const CELL_SIZE = 25;       // 500/20 = 25px, lebih lega buat tap
        const GRID_SIZE = 20;       // 20x20 labirin
        
        const canvas = document.getElementById('mazeCanvas');
        const ctx = canvas.getContext('2d');
        const percentSpan = document.getElementById('percentText');

        // data maze
        let walls = [];
        let paint = [];
        let totalWalkable = 0;
        let paintedCount = 0;

        // state drawing
        let isPainting = false;
        let lastRow = -1, lastCol = -1;

        // ----- buat maze acak (recursive backtracker, dipersimpel) -----
        function generateMaze() {
            walls = Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(true));

            function carve(x, y) {
                walls[y][x] = false;
                const dirs = [
                    [0, -2], [0, 2], [-2, 0], [2, 0]
                ];
                // shuffle
                for (let i = dirs.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [dirs[i], dirs[j]] = [dirs[j], dirs[i]];
                }
                for (let [dx, dy] of dirs) {
                    const nx = x + dx, ny = y + dy;
                    if (nx > 0 && nx < GRID_SIZE-1 && ny > 0 && ny < GRID_SIZE-1 && walls[ny][nx] === true) {
                        walls[y + dy/2][x + dx/2] = false;  // tengah
                        carve(nx, ny);
                    }
                }
            }

            carve(1, 1);   // mulai

            // border tembok
            for (let i = 0; i < GRID_SIZE; i++) {
                walls[0][i] = true;
                walls[GRID_SIZE-1][i] = true;
                walls[i][0] = true;
                walls[i][GRID_SIZE-1] = true;
            }
            // pintu start & goal
            walls[1][1] = false;
            walls[GRID_SIZE-2][GRID_SIZE-2] = false;
        }

        // ----- reset cat -----
        function resetPaint() {
            totalWalkable = 0;
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (!walls[r][c]) totalWalkable++;
                }
            }
            paint = Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(false));
            paintedCount = 0;
            percentSpan.innerText = '0%';
        }

        // ----- gambar visual -----
        function drawMaze() {
            ctx.clearRect(0, 0, 500, 500);
            
            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    const x = col * CELL_SIZE;
                    const y = row * CELL_SIZE;
                    const isWall = walls[row][col];

                    if (isWall) {
                        // tembok gede, gampang kelihatan
                        ctx.fillStyle = '#1c3c44';
                        ctx.fillRect(x, y, CELL_SIZE-1, CELL_SIZE-1);
                        ctx.fillStyle = '#0f262b';
                        ctx.fillRect(x+3, y+3, CELL_SIZE-7, CELL_SIZE-7);
                        // tekstur
                        ctx.fillStyle = '#2b555e';
                        ctx.fillRect(x+1, y+1, 3, 3);
                    } else {
                        // lantai
                        ctx.fillStyle = '#38656e';
                        ctx.fillRect(x, y, CELL_SIZE-1, CELL_SIZE-1);
                        
                        if (paint[row][col]) {
                            // cat warna cerah biar keliatan hasil
                            ctx.fillStyle = '#FFB347';  // orange cerah
                            ctx.shadowBlur = 8;
                            ctx.shadowColor = '#ff9f1a';
                            ctx.fillRect(x+3, y+3, CELL_SIZE-7, CELL_SIZE-7);
                            ctx.shadowBlur = 0;
                            // highlight
                            ctx.fillStyle = '#FFD966';
                            ctx.fillRect(x+5, y+5, CELL_SIZE-11, CELL_SIZE-11);
                        } else {
                            // lantai kosong, titik bantuan
                            ctx.fillStyle = '#2d535c';
                            ctx.fillRect(x+8, y+8, CELL_SIZE-17, CELL_SIZE-17);
                        }
                    }
                }
            }
            // icon start & finish (besar biar kelihatan)
            ctx.font = '18px "Segoe UI", sans-serif';
            ctx.shadowBlur = 4;
            ctx.shadowColor = 'black';
            ctx.fillStyle = '#ffe680';
            ctx.fillText('ðŸšª', 6, 28);
            ctx.fillStyle = '#c1ffb0';
            ctx.fillText('ðŸ', 455, 480);
            ctx.shadowBlur = 0;
        }

        // ----- cat kalau bisa -----
        function tryPaintCell(row, col) {
            if (row < 0 || row >= GRID_SIZE || col < 0 || col >= GRID_SIZE) return false;
            if (walls[row][col]) return false;
            if (paint[row][col]) return false;
            
            paint[row][col] = true;
            paintedCount++;
            let percent = totalWalkable === 0 ? 0 : Math.round((paintedCount / totalWalkable) * 100);
            percentSpan.innerText = percent + '%';
            return true;
        }

        // ----- cek tetangga (biar gak tembus tembok) -----
        function isAdjacent(row, col) {
            if (lastRow === -1 || lastCol === -1) return true;
            const dr = Math.abs(row - lastRow);
            const dc = Math.abs(col - lastCol);
            return (dr === 1 && dc === 0) || (dr === 0 && dc === 1);
        }

        // ----- konversi posisi touch/mouse ke cell -----
        function getCellFromEvent(e) {
            // handle touch event
            let clientX, clientY;
            if (e.touches) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
                e.preventDefault();   // prevent scroll
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;   // canvas physical size vs CSS
            const scaleY = canvas.height / rect.height;
            
            let canvasX = (clientX - rect.left) * scaleX;
            let canvasY = (clientY - rect.top) * scaleY;
            
            // batasin biar gak overflow
            canvasX = Math.min(Math.max(canvasX, 0), canvas.width - 1);
            canvasY = Math.min(Math.max(canvasY, 0), canvas.height - 1);
            
            const col = Math.floor(canvasX / CELL_SIZE);
            const row = Math.floor(canvasY / CELL_SIZE);
            return { row, col };
        }

        // ----- handle start painting (mouse / touch) -----
        function startPaint(e) {
            e.preventDefault();
            const { row, col } = getCellFromEvent(e);
            if (row >= 0 && row < GRID_SIZE && col >= 0 && col < GRID_SIZE) {
                if (!walls[row][col]) {
                    isPainting = true;
                    if (tryPaintCell(row, col)) {
                        lastRow = row;
                        lastCol = col;
                    }
                    drawMaze();
                }
            }
        }

        // ----- paint saat drag -----
        function movePaint(e) {
            if (!isPainting) return;
            e.preventDefault();
            const { row, col } = getCellFromEvent(e);
            if (row < 0 || row >= GRID_SIZE || col < 0 || col >= GRID_SIZE) return;
            if (walls[row][col]) return;
            
            if (isAdjacent(row, col)) {
                if (tryPaintCell(row, col)) {
                    lastRow = row;
                    lastCol = col;
                }
                drawMaze();
            }
        }

        // ----- stop painting -----
        function stopPaint(e) {
            if (isPainting) {
                e.preventDefault();
                isPainting = false;
                lastRow = -1;
                lastCol = -1;
                drawMaze();
            }
        }

        // ----- reset maze + cat -----
        function resetFull() {
            generateMaze();
            resetPaint();
            drawMaze();
            isPainting = false;
            lastRow = -1;
            lastCol = -1;
        }

        // ----- pasang semua event (touch & mouse) -----
        function attachEvents() {
            // mouse events
            canvas.addEventListener('mousedown', startPaint);
            canvas.addEventListener('mousemove', movePaint);
            canvas.addEventListener('mouseup', stopPaint);
            canvas.addEventListener('mouseleave', stopPaint);
            
            // touch events (mobile)
            canvas.addEventListener('touchstart', startPaint, { passive: false });
            canvas.addEventListener('touchmove', movePaint, { passive: false });
            canvas.addEventListener('touchend', stopPaint);
            canvas.addEventListener('touchcancel', stopPaint);
            
            // prevent drag/drop
            canvas.addEventListener('dragstart', (e) => e.preventDefault());
            
            // tombol reset
            document.getElementById('resetBtn').addEventListener('click', resetFull);
            // untuk touch juga
            document.getElementById('resetBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();   // biar gak double tap zoom
                resetFull();
            }, { passive: false });
        }

        // ----- inisialisasi -----
        function init() {
            generateMaze();
            resetPaint();
            drawMaze();
            attachEvents();
        }

        init();
    })();
</script>
</body>
</html>
